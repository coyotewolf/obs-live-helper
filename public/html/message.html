<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>OBS Message Display</title>

<link id="coreStyle" rel="stylesheet" href="/style.css">
<style>
  html,body { background: transparent; margin: 0; padding: 0; }

  #msgBox{
    min-height:100vh;
    white-space:nowrap;
    text-align:left;
    padding:0;margin:0;
    line-height:1;
    font-family:Arial, Helvetica, sans-serif;
    font-variant-numeric:lining-nums;
    font-feature-settings:"lnum" 1;
  }
  #msgBox span,
  #msgBox b,#msgBox i,#msgBox u,#msgBox s,
  #msgBox font{
    display:inline;
    vertical-align:text-bottom;
    line-height:1em;
  }
</style>
</head>
<body>
  <div id="msgBox"></div>
<script>
const box     = document.getElementById('msgBox');
const bcStyle = new BroadcastChannel('obs-style-sync');

refreshMsg();
async function refreshMsg(){
  const txt = await fetch('/api/editor').then(r=>r.text());
  box.innerHTML = txt || '&nbsp;';
}

bcStyle.onmessage = e=>{
  const {type} = e.data;
  if(type==='update-html'){
    box.innerHTML = e.data.html || '&nbsp;';
  }else if(type==='set-css'){
    applyInlineCSS(e.data.css);
  }else if(type==='reload-style'){
    const link = document.getElementById('coreStyle');
    link.href = '/style.css?t=' + Date.now();
  }
};

let inlineStyleEl = null;
function applyInlineCSS(cssText){
  if(!inlineStyleEl){
    inlineStyleEl = document.createElement('style');
    document.head.appendChild(inlineStyleEl);
  }
  inlineStyleEl.textContent = cssText;
}
</script>
</body>
</html>
